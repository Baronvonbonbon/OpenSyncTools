{"version":3,"file":"models.js","sourceRoot":"","sources":["../../src/project/models.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020-2025 SubQuery Pte Ltd authors & contributors\n// SPDX-License-Identifier: GPL-3.0\n\nimport {BaseDataSource, BlockFilterImpl, ProcessorImpl} from '@subql/common';\nimport {BaseMapping, FileReference, Processor} from '@subql/types-core';\nimport {\n  CustomDataSourceAsset as NearCustomDataSourceAsset,\n  NearBlockFilter,\n  NearBlockHandler,\n  NearTransactionHandler,\n  NearActionFilter,\n  NearCustomHandler,\n  NearDatasourceKind,\n  NearTransactionFilter,\n  NearActionHandler,\n  NearHandlerKind,\n  NearRuntimeDatasource,\n  NearRuntimeHandler,\n  NearCustomDatasource,\n  ActionType,\n  NearReceiptHandler,\n  NearReceiptFilter,\n} from '@subql/types-near';\nimport {plainToClass, Transform, Type} from 'class-transformer';\nimport {\n  IsArray,\n  IsEnum,\n  IsOptional,\n  IsString,\n  IsObject,\n  ValidateNested,\n  registerDecorator,\n  ValidationArguments,\n  ValidationOptions,\n  ValidateIf,\n} from 'class-validator';\n\nexport class BlockFilter extends BlockFilterImpl implements NearBlockFilter {}\n\nexport class TransactionFilter extends BlockFilter implements NearTransactionFilter {\n  @IsOptional()\n  @IsString()\n  sender?: string;\n  @IsOptional()\n  @IsString()\n  receiver?: string;\n}\n\nexport function IsActionType(validationOptions?: ValidationOptions) {\n  return function (object: object, propertyName: string) {\n    registerDecorator({\n      name: 'isActionType',\n      target: object.constructor,\n      propertyName: propertyName,\n      constraints: [],\n      options: validationOptions,\n      validator: {\n        validate(value: any, args: ValidationArguments) {\n          return Object.values(ActionType).includes(value);\n        },\n      },\n    });\n  };\n}\n\nexport class ReceiptFilter extends TransactionFilter implements NearReceiptFilter {\n  @IsOptional()\n  @IsString()\n  signer?: string;\n}\n\nexport class ActionFilter extends ReceiptFilter implements NearActionFilter {\n  @IsString()\n  @IsActionType()\n  type!: ActionType;\n\n  @IsString()\n  @IsOptional()\n  @ValidateIf((o: ActionFilter) => {\n    return o.type === ActionType.FunctionCall;\n  })\n  methodName?: string;\n\n  @IsString()\n  @IsOptional()\n  @ValidateIf((o: ActionFilter) => {\n    return o.type === ActionType.FunctionCall;\n  })\n  args?: string;\n\n  @IsString()\n  @IsOptional()\n  @ValidateIf((o: ActionFilter) => {\n    return o.type === ActionType.Stake || o.type === ActionType.AddKey || o.type === ActionType.DeleteKey;\n  })\n  publicKey?: string;\n\n  @IsString()\n  @IsOptional()\n  @ValidateIf((o: ActionFilter) => {\n    return o.type === ActionType.AddKey;\n  })\n  accessKey?: string;\n\n  @IsString()\n  @IsOptional()\n  @ValidateIf((o: ActionFilter) => {\n    return o.type === ActionType.DeleteAccount;\n  })\n  beneficiaryId?: string;\n}\n\nexport class BlockHandler implements NearBlockHandler {\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => BlockFilter)\n  filter?: NearBlockFilter;\n  @IsEnum(NearHandlerKind, {groups: [NearHandlerKind.Block]})\n  kind!: NearHandlerKind.Block;\n  @IsString()\n  handler!: string;\n}\n\nexport class TransactionHandler implements NearTransactionHandler {\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => TransactionFilter)\n  filter?: NearTransactionFilter;\n  @IsEnum(NearHandlerKind, {groups: [NearHandlerKind.Transaction]})\n  kind!: NearHandlerKind.Transaction;\n  @IsString()\n  handler!: string;\n}\n\nexport class ActionHandler implements NearActionHandler {\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => ActionFilter)\n  filter?: NearActionFilter;\n  @IsEnum(NearHandlerKind, {groups: [NearHandlerKind.Action]})\n  kind!: NearHandlerKind.Action;\n  @IsString()\n  handler!: string;\n}\n\nexport class ReceiptHandler implements NearReceiptHandler {\n  @IsOptional()\n  @ValidateNested()\n  @Type(() => ReceiptFilter)\n  filter?: NearReceiptFilter;\n  @IsEnum(NearHandlerKind, {groups: [NearHandlerKind.Receipt]})\n  kind!: NearHandlerKind.Receipt;\n  @IsString()\n  handler!: string;\n}\n\nexport class CustomHandler implements NearCustomHandler {\n  @IsString()\n  kind!: string;\n  @IsString()\n  handler!: string;\n  @IsObject()\n  @IsOptional()\n  filter?: Record<string, unknown>;\n}\n\nexport class RuntimeMapping implements BaseMapping<NearRuntimeHandler> {\n  @Transform((params) => {\n    const handlers: NearRuntimeHandler[] = params.value;\n    return handlers.map((handler) => {\n      switch (handler.kind) {\n        case NearHandlerKind.Receipt:\n          return plainToClass(ReceiptHandler, handler);\n        case NearHandlerKind.Action:\n          return plainToClass(ActionHandler, handler);\n        case NearHandlerKind.Transaction:\n          return plainToClass(TransactionHandler, handler);\n        case NearHandlerKind.Block:\n          return plainToClass(BlockHandler, handler);\n        default:\n          throw new Error(`handler ${(handler as any).kind} not supported`);\n      }\n    });\n  })\n  @IsArray()\n  @ValidateNested()\n  handlers!: NearRuntimeHandler[];\n  @IsString()\n  file!: string;\n}\n\nexport class CustomMapping implements BaseMapping<NearCustomHandler> {\n  @IsArray()\n  @Type(() => CustomHandler)\n  @ValidateNested()\n  handlers!: CustomHandler[];\n  @IsString()\n  file!: string;\n}\n\nexport class RuntimeDataSourceBase extends BaseDataSource implements NearRuntimeDatasource {\n  @IsEnum(NearDatasourceKind, {groups: [NearDatasourceKind.Runtime]})\n  kind!: NearDatasourceKind.Runtime;\n  @Type(() => RuntimeMapping)\n  @ValidateNested()\n  mapping!: RuntimeMapping;\n}\n\nexport class FileReferenceImpl implements FileReference {\n  @IsString()\n  file!: string;\n}\n\nexport class CustomDataSourceBase<K extends string, M extends CustomMapping, O = any>\n  extends BaseDataSource\n  implements NearCustomDatasource<K, M>\n{\n  @IsString()\n  kind!: K;\n  @Type(() => CustomMapping)\n  @ValidateNested()\n  mapping!: M;\n  @Type(() => FileReferenceImpl)\n  @ValidateNested({each: true})\n  assets!: Map<string, NearCustomDataSourceAsset>;\n  @Type(() => ProcessorImpl)\n  @IsObject()\n  processor!: Processor;\n}\n"]}