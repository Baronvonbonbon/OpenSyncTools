"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.plugin = void 0;
const x_cosmology_ast_1 = require("@subql/x-cosmology-ast");
const plugin = (builder, bundler) => {
    if (!builder.options.bundle.enabled) {
        return;
    }
    // [x] bundle
    const body = (0, x_cosmology_ast_1.recursiveModuleBundle)(builder.options, bundler.bundle.bundleVariables);
    const prog = []
        .concat(bundler.bundle.importPaths)
        .concat(body);
    const localname = bundler.bundle.bundleFile;
    const filename = bundler.getFilename(localname);
    bundler.writeAst(prog, filename);
    // [x] write an index file for each base
    bundler.files.forEach(file => builder.files.push(file));
};
exports.plugin = plugin;
