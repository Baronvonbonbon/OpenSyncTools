{"version":3,"file":"datasourceProcessors.js","sourceRoot":"","sources":["../../src/project/datasourceProcessors.ts"],"names":[],"mappings":";AAAA,8DAA8D;AAC9D,mCAAmC","sourcesContent":["// Copyright 2020-2024 SubQuery Pte Ltd authors & contributors\n// SPDX-License-Identifier: GPL-3.0\n\nimport {DictionaryQueryEntry} from './types';\nimport {BaseCustomDataSource} from './versioned';\n\n/**\n * Maps a handler kind to the data type\n * @example {\n * 'block': BlockType,\n * 'transaction': TransactionType,\n * 'event': EventType,\n * }*/\nexport type HandlerInputMap = Record<string, any>;\n\nexport interface HandlerInputTransformer_0_0_0<\n  IM extends HandlerInputMap,\n  K extends keyof IM,\n  DS extends BaseCustomDataSource,\n  API,\n  E // Output type\n> {\n  (input: IM[K], ds: DS, api: API, assets?: Record<string, string>): Promise<E>;\n}\n\nexport interface HandlerInputTransformer_1_0_0<\n  IM extends HandlerInputMap,\n  K extends keyof IM,\n  DS extends BaseCustomDataSource,\n  API,\n  F extends Record<string, unknown>,\n  E // Output type\n> {\n  (params: {input: IM[K]; ds: DS; api: API; filter?: F; assets?: Record<string, string>}): Promise<E[]>;\n}\n\ninterface SecondLayerHandlerProcessorBase<\n  IM extends HandlerInputMap,\n  K extends keyof IM,\n  F extends Record<string, unknown>,\n  DS extends BaseCustomDataSource\n> {\n  baseHandlerKind: K;\n  baseFilter: IM[K] | IM[K][];\n  filterValidator: (filter?: F) => void;\n  dictionaryQuery?: (filter: F, ds: DS) => DictionaryQueryEntry | undefined;\n}\n\n// only allow one custom handler for each baseHandler kind\nexport interface SecondLayerHandlerProcessor_0_0_0<\n  IM extends HandlerInputMap,\n  K extends keyof IM,\n  F extends Record<string, unknown>,\n  E,\n  DS extends BaseCustomDataSource,\n  API\n> extends SecondLayerHandlerProcessorBase<IM, K, F, DS> {\n  specVersion: undefined;\n  transformer: HandlerInputTransformer_0_0_0<IM, K, DS, API, E>;\n  filterProcessor: (filter: F | undefined, input: IM[K], ds: DS) => boolean;\n}\n\nexport interface SecondLayerHandlerProcessor_1_0_0<\n  IM extends HandlerInputMap,\n  K extends keyof IM,\n  F extends Record<string, unknown>,\n  E,\n  DS extends BaseCustomDataSource,\n  API\n> extends SecondLayerHandlerProcessorBase<IM, K, F, DS> {\n  specVersion: '1.0.0';\n  transformer: HandlerInputTransformer_1_0_0<IM, K, DS, API, F, E>;\n  filterProcessor: (params: {filter: F | undefined; input: IM[K]; ds: DS}) => boolean;\n}\n\nexport type SecondLayerHandlerProcessor<\n  IM extends HandlerInputMap,\n  K extends keyof IM,\n  F extends Record<string, unknown>,\n  E,\n  DS extends BaseCustomDataSource,\n  API\n> = SecondLayerHandlerProcessor_0_0_0<IM, K, F, E, DS, API> | SecondLayerHandlerProcessor_1_0_0<IM, K, F, E, DS, API>;\n"]}