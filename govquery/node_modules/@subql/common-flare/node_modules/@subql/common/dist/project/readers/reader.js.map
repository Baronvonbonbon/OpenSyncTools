{"version":3,"file":"reader.js","sourceRoot":"","sources":["../../../src/project/readers/reader.ts"],"names":[],"mappings":";AAAA,8DAA8D;AAC9D,mCAAmC;;;;;;AAEnC,4CAAoB;AACpB,gDAAwB;AAExB,+CAA2C;AAC3C,2CAAwD;AACxD,mDAA6C;AAC7C,+CAAyC;AACzC,iDAA2C;AAE3C,MAAa,aAAa;IACxB,4DAA4D;IAC5D,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,QAAgB,EAAE,OAAuB;QAC3D,iEAAiE;QACjE,MAAM,WAAW,GAAG,QAAQ,CAAC,KAAK,CAAC,2CAA2C,CAAC,CAAC;QAChF,IAAI,WAAW,EAAE;YACf,OAAO,IAAI,4BAAY,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;SACzC;QAED,MAAM,SAAS,GAAG,QAAQ,CAAC,KAAK,CAAC,sBAAU,CAAC,CAAC;QAC7C,IAAI,SAAS,EAAE;YACb,OAAO,IAAI,wBAAU,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;SACvE;QAED,YAAY;QACZ,IAAI,YAAE,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE;YAC3B,MAAM,OAAO,GAAG,IAAA,mCAAyB,EAAC,QAAQ,CAAC,CAAC;YACpD,IAAI,OAAO,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE;gBAChC,MAAM,IAAI,KAAK,CAAC,6CAA6C,CAAC,CAAC;aAChE;YACD,OAAO,IAAI,0BAAW,CAAC,OAAO,CAAC,IAAI,EAAE,cAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;SACrF;QAED,MAAM,IAAI,KAAK,CAAC,qBAAqB,QAAQ,EAAE,CAAC,CAAC;IACnD,CAAC;CACF;AAzBD,sCAyBC","sourcesContent":["// Copyright 2020-2024 SubQuery Pte Ltd authors & contributors\n// SPDX-License-Identifier: GPL-3.0\n\nimport fs from 'fs';\nimport path from 'path';\nimport {Reader, ReaderOptions} from '@subql/types-core';\nimport {IPFS_REGEX} from '../../constants';\nimport {getProjectRootAndManifest} from '../../project';\nimport {GithubReader} from './github-reader';\nimport {IPFSReader} from './ipfs-reader';\nimport {LocalReader} from './local-reader';\n\nexport class ReaderFactory {\n  // eslint-disable-next-line @typescript-eslint/require-await\n  static async create(location: string, options?: ReaderOptions): Promise<Reader> {\n    // eslint-disable-next-line @typescript-eslint/prefer-regexp-exec\n    const githubMatch = location.match(/https:\\/\\/github.com\\/([\\w-_]+\\/[\\w-_]+)/i);\n    if (githubMatch) {\n      return new GithubReader(githubMatch[1]);\n    }\n\n    const ipfsMatch = location.match(IPFS_REGEX);\n    if (ipfsMatch) {\n      return new IPFSReader(location.replace('ipfs://', ''), options?.ipfs);\n    }\n\n    //local mode\n    if (fs.existsSync(location)) {\n      const project = getProjectRootAndManifest(location);\n      if (project.manifests.length > 1) {\n        throw new Error(`Mulitple manifests found, expected only one`);\n      }\n      return new LocalReader(project.root, path.join(project.root, project.manifests[0]));\n    }\n\n    throw new Error(`unknown location: ${location}`);\n  }\n}\n"]}