{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../src/project/utils.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020-2024 SubQuery Pte Ltd authors & contributors\n// SPDX-License-Identifier: GPL-3.0\n\nimport fs from 'fs';\nimport os from 'os';\nimport path from 'path';\nimport {BaseDataSource, FileReference, MultichainProjectManifest, ProjectRootAndManifest} from '@subql/types-core';\nimport {\n  registerDecorator,\n  validateSync,\n  ValidationArguments,\n  ValidationOptions,\n  ValidatorConstraint,\n  ValidatorConstraintInterface,\n} from 'class-validator';\nimport detectPort from 'detect-port';\nimport * as yaml from 'js-yaml';\nimport Pino from 'pino';\nimport {lt, prerelease, satisfies, valid, validRange} from 'semver';\nimport updateNotifier, {Package} from 'update-notifier';\nimport {RUNNER_ERROR_REGEX} from '../constants';\n\nexport const DEFAULT_MULTICHAIN_MANIFEST = 'subquery-multichain.yaml';\nexport const DEFAULT_MULTICHAIN_TS_MANIFEST = 'subquery-multichain.ts';\nexport const DEFAULT_MANIFEST = 'project.yaml';\nexport const DEFAULT_TS_MANIFEST = 'project.ts';\nexport const DEFAULT_ENV = '.env';\nexport const DEFAULT_ENV_DEVELOP = '.env.develop';\nexport const DEFAULT_ENV_LOCAL = '.env.local';\nexport const DEFAULT_ENV_DEVELOP_LOCAL = '.env.develop.local';\nexport const DEFAULT_GIT_IGNORE = '.gitignore';\n\nexport function isFileReference(value: any): value is FileReference {\n  return value?.file && typeof value.file === 'string';\n}\n\n// Input manifest here, we might need to handler other error later on\nexport function handleCreateSubqueryProjectError(err: Error, pjson: any, rawManifest: any, logger: Pino.Logger) {\n  if (JSON.stringify(err.message).includes(RUNNER_ERROR_REGEX)) {\n    logger.error(`Failed to init project, required runner is ${rawManifest.runner.node.name}, got ${pjson.name}`);\n  } else {\n    logger.error(err, 'Create Subquery project from given path failed!');\n  }\n}\n\nexport async function makeTempDir(): Promise<string> {\n  const sep = path.sep;\n  const tmpDir = os.tmpdir();\n  const tempPath = await fs.promises.mkdtemp(`${tmpDir}${sep}`);\n  return tempPath;\n}\n\nexport async function findAvailablePort(startPort: number, range = 10): Promise<number | null> {\n  for (let port = startPort; port <= startPort + range; port++) {\n    try {\n      const _port = await detectPort(port);\n      if (_port === port) {\n        return port;\n      }\n    } catch (e) {\n      return null;\n    }\n  }\n\n  return null;\n}\n\nexport function getProjectRootAndManifest(subquery: string): ProjectRootAndManifest {\n  const project: ProjectRootAndManifest = {\n    root: '',\n    manifests: [],\n  };\n\n  const stats = fs.statSync(subquery);\n\n  if (stats.isDirectory()) {\n    project.root = subquery;\n\n    if (fs.existsSync(path.resolve(subquery, DEFAULT_MANIFEST))) {\n      project.manifests.push(path.resolve(subquery, DEFAULT_MANIFEST));\n    }\n    // Then check for a 'multichain manifest'\n    else if (fs.existsSync(path.resolve(subquery, DEFAULT_MULTICHAIN_MANIFEST))) {\n      const multichainManifestContent: MultichainProjectManifest = yaml.load(\n        fs.readFileSync(path.resolve(subquery, DEFAULT_MULTICHAIN_MANIFEST), 'utf8')\n      ) as MultichainProjectManifest;\n\n      if (!multichainManifestContent.projects || !Array.isArray(multichainManifestContent.projects)) {\n        throw new Error('Multichain manifest does not contain a valid \"projects\" field');\n      }\n\n      addMultichainManifestProjects(subquery, multichainManifestContent, project);\n    } else {\n      throw new Error(`Unable to resolve manifest file from given directory: ${subquery}`);\n    }\n  } else if (stats.isFile()) {\n    const {dir, ext} = path.parse(subquery);\n    if (!extensionIsTs(ext) && !extensionIsYamlOrJSON(ext)) {\n      throw new Error(`Extension ${ext} not supported for project ${subquery}`);\n    }\n    project.root = dir;\n    let projectYamlPath = subquery;\n\n    if (extensionIsTs(ext)) {\n      projectYamlPath = tsProjectYamlPath(subquery);\n      if (!fs.existsSync(projectYamlPath)) {\n        throw new Error(\n          `Could not find manifest ${projectYamlPath}, if pointing to a typescript manifest, please ensure build successfully`\n        );\n      }\n    }\n\n    const multichainManifestContent = yaml.load(fs.readFileSync(projectYamlPath, 'utf8')) as MultichainProjectManifest;\n    // The project manifest could be empty\n    if (multichainManifestContent === null) {\n      throw new Error(`Read manifest content is null, ${projectYamlPath}`);\n    } else if (multichainManifestContent.projects && Array.isArray(multichainManifestContent.projects)) {\n      addMultichainManifestProjects(dir, multichainManifestContent, project);\n    } else {\n      project.manifests.push(projectYamlPath);\n    }\n  }\n\n  project.root = path.resolve(project.root);\n\n  // Convert manifest paths to be relative to the project root\n  project.manifests = project.manifests.map((manifestPath) => {\n    return path.relative(project.root, manifestPath);\n  });\n\n  return project;\n}\n\nfunction addMultichainManifestProjects(\n  parentDir: string,\n  multichainManifestContent: any,\n  project: ProjectRootAndManifest\n) {\n  for (const projectPath of multichainManifestContent.projects) {\n    const {ext} = path.parse(projectPath);\n    if (!extensionIsYamlOrJSON(ext)) {\n      throw new Error(`Extension ${ext} not supported for project ${projectPath}`);\n    }\n\n    if (fs.existsSync(path.resolve(parentDir, projectPath))) {\n      project.manifests.push(path.resolve(parentDir, projectPath));\n    } else {\n      throw new Error(`Project ${projectPath} not found`);\n    }\n  }\n\n  if (project.manifests.length === 0) {\n    throw new Error('None of the project files specified in the multichain manifest could be found');\n  }\n}\n\nexport function getMultichainManifestPath(subquery: string): string | undefined {\n  const stats = fs.statSync(subquery);\n  let multichainManifestPath: string | undefined;\n  let projectRoot: string | undefined;\n\n  if (stats.isDirectory()) {\n    projectRoot = subquery;\n    const multichainManifestCandidate = path.resolve(subquery, DEFAULT_MULTICHAIN_MANIFEST);\n    if (fs.existsSync(multichainManifestCandidate)) {\n      multichainManifestPath = multichainManifestCandidate;\n    }\n  } else if (stats.isFile()) {\n    const {dir, ext} = path.parse(subquery);\n    projectRoot = dir;\n    if (extensionIsYamlOrJSON(ext)) {\n      const multichainManifestContent = yaml.load(fs.readFileSync(subquery, 'utf8')) as MultichainProjectManifest;\n      if (multichainManifestContent.projects && Array.isArray(multichainManifestContent.projects)) {\n        multichainManifestPath = path.resolve(dir, subquery);\n      }\n    }\n  }\n\n  if (multichainManifestPath && projectRoot) {\n    return path.relative(projectRoot, multichainManifestPath);\n  }\n\n  return undefined;\n}\n\nexport function validateSemver(current: string, required: string): boolean {\n  return satisfies(current, required, {includePrerelease: true});\n}\n\n@ValidatorConstraint({name: 'semver', async: false})\nexport class SemverVersionValidator implements ValidatorConstraintInterface {\n  validate(value: string | null | undefined): boolean {\n    if (valid(value) === null) {\n      return validRange(value, {includePrerelease: false}) !== null;\n    } else {\n      return prerelease(value || '') === null;\n    }\n  }\n  defaultMessage(args: ValidationArguments): string {\n    return `'${args.value}' is not a valid version. Please provide a valid semver`;\n  }\n}\n\nexport async function delay(sec: number): Promise<void> {\n  return new Promise((resolve) => {\n    setTimeout(resolve, sec * 1000);\n  });\n}\n\nexport function validateObject(object: any, errorMessage = 'failed to validate object.'): void {\n  const errors = validateSync(object, {whitelist: true, forbidNonWhitelisted: true});\n  if (errors?.length) {\n    const errorMsgs = errors.map((e) => e.toString()).join('\\n');\n    throw new Error(`${errorMessage}\\n${errorMsgs}`);\n  }\n}\n\nexport function extensionIsTs(ext: string): boolean {\n  return ext === '.ts';\n}\n\nexport function extensionIsYamlOrJSON(ext: string): boolean {\n  return ext === '.yaml' || ext === '.yml' || ext === '.json';\n}\n\nexport function forbidNonWhitelisted(keys: any, validationOptions?: ValidationOptions) {\n  return function (object: object, propertyName: string) {\n    registerDecorator({\n      name: 'forbidNonWhitelisted',\n      target: object.constructor,\n      propertyName: propertyName,\n      constraints: [],\n      options: validationOptions,\n      validator: {\n        validate(value: any, args: ValidationArguments) {\n          const isValid = !Object.keys(value).some((key) => !(key in keys));\n          if (!isValid) {\n            throw new Error(\n              `Invalid keys present in value: ${JSON.stringify(value)}. Whitelisted keys: ${JSON.stringify(\n                Object.keys(keys)\n              )}`\n            );\n          }\n          return isValid;\n        },\n      },\n    });\n  };\n}\n\nexport function notifyUpdates(pjson: Package, logger: Pino.Logger): void {\n  const notifier = updateNotifier({pkg: pjson, updateCheckInterval: 0});\n\n  const latestVersion = notifier.update ? notifier.update.latest : pjson.version;\n\n  if (notifier.update && lt(pjson.version, latestVersion)) {\n    logger.info(`Update available: ${pjson.version} â†’ ${latestVersion}`);\n  } else {\n    logger.info(`Current ${pjson.name} version is ${pjson.version}`);\n  }\n}\n\nexport function toJsonObject(object: unknown): unknown {\n  // When using plainToInstance or plainToClass, Map types will need to be converted to a JSON object\n  // https://github.com/typestack/class-transformer/issues/1256#issuecomment-1175153352\n  return JSON.parse(\n    JSON.stringify(object, (_, value: unknown) => {\n      if (value instanceof Map) {\n        return mapToObject(value);\n      }\n      return value;\n    })\n  );\n}\n\nexport function mapToObject(map: Map<string | number, unknown>): Record<string | number, unknown> {\n  // XXX can use Object.entries with newer versions of node.js\n  const assetsObj: Record<string, unknown> = {};\n  for (const key of map.keys()) {\n    assetsObj[key] = map.get(key);\n  }\n  return assetsObj;\n}\n\n@ValidatorConstraint({name: 'isFileReference', async: false})\nexport class FileReferenceImp<T> implements ValidatorConstraintInterface {\n  validate(value: Map<string, T>): boolean {\n    if (!value) {\n      return false;\n    }\n    return !!Object.values(value).find((fileReference: T) => this.isValidFileReference(fileReference));\n  }\n  defaultMessage(args: ValidationArguments): string {\n    return `${JSON.stringify(args.value)} is not a valid assets format`;\n  }\n\n  private isValidFileReference(fileReference: T): boolean {\n    return (\n      fileReference &&\n      typeof fileReference === 'object' &&\n      'file' in fileReference &&\n      typeof fileReference.file === 'string'\n    );\n  }\n}\n\nexport const tsProjectYamlPath = (tsManifestEntry: string) => tsManifestEntry.replace('.ts', '.yaml');\n\n@ValidatorConstraint({async: false})\nexport class IsEndBlockGreater implements ValidatorConstraintInterface {\n  validate(endBlock: number, args: ValidationArguments) {\n    const object = args.object as BaseDataSource;\n    return object.startBlock !== undefined && object.endBlock !== undefined\n      ? object.endBlock >= object.startBlock\n      : true;\n  }\n\n  defaultMessage(args: ValidationArguments) {\n    return 'End block must be greater than or equal to start block';\n  }\n}\n"]}