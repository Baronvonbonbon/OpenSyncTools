{"version":3,"file":"model.js","sourceRoot":"","sources":["../../../../src/project/versioned/v1_0_0/model.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020-2024 SubQuery Pte Ltd authors & contributors\n// SPDX-License-Identifier: GPL-3.0\n\nimport {\n  BaseDeploymentV1_0_0,\n  FileType,\n  ParentProjectModel,\n  ProjectManifestBaseImpl,\n  RunnerNodeImpl,\n  RunnerQueryBaseModel,\n} from '@subql/common';\nimport {BaseMapping, NodeSpec, RunnerSpecs, QuerySpec, ParentProject} from '@subql/types-core';\nimport {\n  CustomDatasourceTemplate,\n  EthereumProjectManifestV1_0_0,\n  RuntimeDatasourceTemplate,\n  SubqlCustomDatasource,\n  SubqlMapping,\n  SubqlRuntimeDatasource,\n} from '@subql/types-flare';\nimport {plainToInstance, Transform, TransformFnParams, Type} from 'class-transformer';\nimport {\n  Equals,\n  IsArray,\n  IsIn,\n  IsNotEmpty,\n  IsObject,\n  IsOptional,\n  IsString,\n  ValidateNested,\n  validateSync,\n} from 'class-validator';\nimport {CustomDataSourceBase, RuntimeDataSourceBase} from '../../models';\nimport {SubqlEthereumDataSource, SubqlRuntimeHandler} from '../../types';\n\nconst Ethereum_NODE_NAME = `@subql/node-flare`;\nconst Flare_NODE_NAME = `@subql/node-flare`;\n\nexport class EthereumRunnerNodeImpl extends RunnerNodeImpl {\n  @IsIn([Ethereum_NODE_NAME, Flare_NODE_NAME], {\n    message: `Runner Substrate node name incorrect, suppose be '${Ethereum_NODE_NAME}'`,\n  })\n  name: string = Ethereum_NODE_NAME;\n}\n\nfunction validateObject(object: any, errorMessage = 'failed to validate object.'): void {\n  const errors = validateSync(object, {whitelist: true, forbidNonWhitelisted: true});\n  if (errors?.length) {\n    const errorMsgs = errors.map((e) => e.toString()).join('\\n');\n    throw new Error(`${errorMessage}\\n${errorMsgs}`);\n  }\n}\n\nexport class EthereumRuntimeDataSourceImpl\n  extends RuntimeDataSourceBase<SubqlMapping<SubqlRuntimeHandler>>\n  implements SubqlRuntimeDatasource\n{\n  validate(): void {\n    return validateObject(this, 'failed to validate runtime datasource.');\n  }\n}\n\nexport class EthereumCustomDataSourceImpl<K extends string = string, M extends BaseMapping<any> = BaseMapping<any>>\n  extends CustomDataSourceBase<K, M>\n  implements SubqlCustomDatasource<K, M>\n{\n  validate(): void {\n    return validateObject(this, 'failed to validate custom datasource.');\n  }\n}\n\nexport class RuntimeDatasourceTemplateImpl extends EthereumRuntimeDataSourceImpl implements RuntimeDatasourceTemplate {\n  @IsString()\n  name: string;\n}\n\nexport class CustomDatasourceTemplateImpl extends EthereumCustomDataSourceImpl implements CustomDatasourceTemplate {\n  @IsString()\n  name: string;\n}\n\nexport class EthereumRunnerSpecsImpl implements RunnerSpecs {\n  @IsObject()\n  @ValidateNested()\n  @Type(() => EthereumRunnerNodeImpl)\n  node: NodeSpec;\n  @IsObject()\n  @ValidateNested()\n  @Type(() => RunnerQueryBaseModel)\n  query: QuerySpec;\n}\n\nexport class ProjectNetworkDeploymentV1_0_0 {\n  @IsNotEmpty()\n  @Transform(({value}: TransformFnParams) => value.trim())\n  @IsString()\n  chainId: string;\n  @ValidateNested()\n  @Type(() => FileType)\n  @IsOptional()\n  chaintypes?: FileType;\n  @IsOptional()\n  @IsArray()\n  bypassBlocks?: (number | `${number}-${number}`)[];\n}\n\nexport class ProjectNetworkV1_0_0 extends ProjectNetworkDeploymentV1_0_0 {\n  @IsString({each: true})\n  endpoint: string | string[];\n  @IsString()\n  @IsOptional()\n  dictionary?: string;\n}\n\nexport class DeploymentV1_0_0 extends BaseDeploymentV1_0_0 {\n  @Transform((params) => {\n    if (params.value.genesisHash && !params.value.chainId) {\n      params.value.chainId = params.value.genesisHash;\n    }\n    return plainToInstance(ProjectNetworkDeploymentV1_0_0, params.value);\n  })\n  @ValidateNested()\n  @Type(() => ProjectNetworkDeploymentV1_0_0)\n  network: ProjectNetworkDeploymentV1_0_0;\n  @IsObject()\n  @ValidateNested()\n  @Type(() => EthereumRunnerSpecsImpl)\n  runner: RunnerSpecs;\n  @IsArray()\n  @ValidateNested()\n  @Type(() => EthereumCustomDataSourceImpl, {\n    discriminator: {\n      property: 'kind',\n      subTypes: [\n        {value: EthereumRuntimeDataSourceImpl, name: 'flare/Runtime'},\n        {value: EthereumRuntimeDataSourceImpl, name: 'ethereum/Runtime'},\n      ],\n    },\n    keepDiscriminatorProperty: true,\n  })\n  dataSources: (SubqlRuntimeDatasource | SubqlCustomDatasource)[];\n  @IsOptional()\n  @IsArray()\n  @ValidateNested()\n  @Type(() => CustomDatasourceTemplateImpl, {\n    discriminator: {\n      property: 'kind',\n      subTypes: [\n        {value: RuntimeDatasourceTemplateImpl, name: 'flare/Runtime'},\n        {value: RuntimeDatasourceTemplateImpl, name: 'ethereum/Runtime'},\n      ],\n    },\n    keepDiscriminatorProperty: true,\n  })\n  templates?: (RuntimeDatasourceTemplate | CustomDatasourceTemplate)[];\n}\n\nexport class ProjectManifestV1_0_0Impl\n  extends ProjectManifestBaseImpl<DeploymentV1_0_0>\n  implements EthereumProjectManifestV1_0_0\n{\n  constructor() {\n    super(DeploymentV1_0_0);\n  }\n\n  @Equals('1.0.0')\n  specVersion = '1.0.0';\n  @Type(() => EthereumCustomDataSourceImpl, {\n    discriminator: {\n      property: 'kind',\n      subTypes: [\n        {value: EthereumRuntimeDataSourceImpl, name: 'flare/Runtime'},\n        {value: EthereumRuntimeDataSourceImpl, name: 'ethereum/Runtime'},\n      ],\n    },\n    keepDiscriminatorProperty: true,\n  })\n  dataSources: SubqlEthereumDataSource[];\n  @Type(() => ProjectNetworkV1_0_0)\n  network: ProjectNetworkV1_0_0;\n  @IsString()\n  name: string;\n  @IsString()\n  version: string;\n  @ValidateNested()\n  @Type(() => FileType)\n  schema: FileType;\n  @IsOptional()\n  @IsArray()\n  @ValidateNested()\n  @Type(() => CustomDatasourceTemplateImpl, {\n    discriminator: {\n      property: 'kind',\n      subTypes: [\n        {value: RuntimeDatasourceTemplateImpl, name: 'flare/Runtime'},\n        {value: RuntimeDatasourceTemplateImpl, name: 'ethereum/Runtime'},\n      ],\n    },\n    keepDiscriminatorProperty: true,\n  })\n  templates?: (RuntimeDatasourceTemplate | CustomDatasourceTemplate)[];\n  @IsObject()\n  @ValidateNested()\n  @Type(() => EthereumRunnerSpecsImpl)\n  runner: RunnerSpecs;\n\n  @IsOptional()\n  @IsObject()\n  @Type(() => ParentProjectModel)\n  parent?: ParentProject;\n}\n"]}